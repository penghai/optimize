- name: install bash package
  yum:
    name:
      - wget
      - vim 
      - net-tools
      - bash-completion
      - bash-completion-extras
      - lrzsz
    state: present

- name: Disable SELinux
  selinux:
    state: disabled
  
- name: systemctl stop firewalld.service
  service:
    name: firewalld
    state: stopped
    enabled: no

- name: Set timezone to Asia/Shanghai
  timezone:
    name: Asia/Shanghai

- name: Set /etc/security/limits.conf
  pam_limits:
    domain: '*'
    limit_type: "{{ item.type }}"
    limit_item: "{{ item.item }}"
    value: '65535'
  with_items:
    - { type: 'soft',item: 'nproc' }
    - { type: 'hard',item: 'nproc' }
    - { type: 'soft',item: 'nofile' }
    - { type: 'hard',item: 'nofile' }

- name: Set /etc/sysctl.conf
  sysctl:
    name: '{{ item.name }}'
    value: '{{ item.value }}'
    state: present
    sysctl_set: yes
    reload: yes
  with_items:
    - { name: 'vm.swappiness',value: '0' }
    - { name: 'kernel.sysrq',value: '0' }
    - { name: 'kernel.msgmnb',value: '65536' }
    - { name: 'kernel.msgmax',value: '65536' }
    - { name: 'kernel.shmmax',value: '8589934592' }
    - { name: 'kernel.shmall',value: '8589934592' }
    - { name: 'kernel.pid_max',value: '65536' }
    - { name: 'kernel.core_uses_pid',value: '1' }
    - { name: 'net.core.rmem_max',value: '16777216' }
    - { name: 'net.core.wmem_max',value: '16777216' }
    - { name: 'net.ipv4.tcp_rmem',value: '4096 8388608 16777216' }
    - { name: 'net.ipv4.tcp_wmem',value: '4096 8388608 16777216' }
    - { name: 'net.core.netdev_max_backlog',value: '300000' }
    - { name: 'net.ipv4.tcp_max_syn_backlog',value: '8192' }
    - { name: 'net.ipv4.tcp_congestion_control',value: 'htcp' }
    - { name: 'net.ipv4.tcp_mtu_probing',value: '1' }
    - { name: 'net.ipv4.ip_local_port_range',value: '10240 65000' }
    - { name: 'net.ipv4.tcp_tw_recycle',value: '1' }
    - { name: 'net.ipv4.tcp_tw_reuse',value: '1' }
    - { name: 'net.ipv4.conf.all.rp_filter',value: '1' }
    - { name: 'net.ipv4.conf.default.rp_filter',value: '1' }
    - { name: 'net.ipv4.conf.default.accept_source_route',value: '0' }
    - { name: 'net.ipv4.tcp_syncookies',value: '1' }
    - { name: 'net.ipv4.tcp_fin_timeout',value: '30' }
    - { name: 'net.core.somaxconn',value: '262144' }
    - { name: 'net.ipv4.ip_nonlocal_bind',value: '1' }
    - { name: 'net.ipv4.route.flush',value: '1' }
